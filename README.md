#  优化完善



？：改了端口号之后连接网络失败，改的是packdef中的宏

~~优化：使用自定义放大缩小√~~

优化：在生日当天发送祝福

~~优化？：在某个界面不再使用的时候销毁它（注册界面不行，如果注册失败还要在界面上显示提示框）不可行~~

~~优化：密码加密~~

~~优化：登陆时用户已在线，强制上一个用户下线√~~

优化：重写退出事件

~~优化：主界面tabweight页面标题栏的宽度（可以看网络课程qq主界面部分视频）√~~

优化：等级（个人信息设置）

~~完善：下线时删除服务端对应的映射~~

~~！！！！！！记得传数据库文件！！！！！！！！！！~~

~~！！！！！！删除改名的文件夹！！！！！！！！！~~

完善：游戏模式

优化：房间列表按某项排序

小bug：强制退出那里

优化：房间上限（目前是创建房间必成功）

TODO：设置中有退出登录

小bug：如果是异常退出的话，不走析构函数，不会发送求出登录的包

tip:退出事件还没写

优化：房间名

完善：反馈

优化：获取房间列表添加一个等待界面

优化：房间密码规定数字字母

完善：加入房间判断（？什么意思来着）

完善：服务器断开或崩溃时，给所有在线用户发送异常包

完善：关于玩法回复包中都没设置（定义都没写，）







# bug

1. 房间列表不能根据房间号获取房间信息：输入房间号，不管输入了什么，都是列出所有房间

   解决：在服务端通过房间好获取房间信息后，是很据获取的信息有无来判断客户端是根据房间号查找还是筛选条件查找，因此如果输入的房间号错误，是获取不到房间信息的，这个时候服务端误判为是根据筛选条件进行查找了。

2. 新注册了个账号，登陆的时候会造成服务器崩溃（逻辑错误）

   解决：注册的时候没有给level属性赋值，导致登陆的时候去数据库查询该属性放到链表中，数值不存在，赋值失败。

3. 创建房间加入房间时客户端崩溃

   解决：客户端的房间界面时在设置房间信息函数内部创建成员子控件的；服务端在收到加入房间请求后，是先发送成员信息，再发送房间信息的，客户端在处理设置成员信息时，还没有收到房间信息，并没有创建成员类，此时给成员类赋值，造成异常。

4. 加入房间后，闪退，画面只显示了两个成员控件

   解决：和第3条同一个原因

5. 房主创建房间后，如果有新成员进来，会显示新成员的信息；但是新成员只能设置房主的信息，自己的和后面再进来的成员都设置不了

   解决：原因1：服务端在把新用户添加到链表后没有放进映射中，所以后面的人获取不到除房主外的其他成员信息

   ​			原因2：服务端在发送成员列表时，没有给新成员发送它自己的信息包，导致新成员不能设置自己的信息





# 第一天



设计启动界面（点击公告，弹出公告栏；点击进入游戏：连接网络隐藏窗口，显示登录窗口）

ckernel类（单例模式）

点击进入游戏->启动窗口发送信号-》ckernel类处理信号（打开网络，隐藏启动窗口，显示登录窗口）





# 第二天



绘制登录界面、注册界面

完成注册功能：用户名（英文or数字or下划线）、密码、个人信息等（优化：验证码）

完成登录功能：服务端发送个人信息给客户端，客户端设置个人信息

下一步：客户端处理个人信息

未解：强制退出账号时，如果在游戏中的话...





# 第三天



完成主界面绘制（半成品）

优化退出和最小化，设置部分背景

密码加密优化

完成个人信息设置

下一步：创建房间





# 第四天



创建房间：游戏玩法（基础玩法：3（测试用）6-12人只有神民狼 神：预言家、女巫 ）、是否允许抢身份（优化项）、是否加密、等级限制、

完成了客户端发送创建房间请求

新建了几张表（好像并不用这么多张...）

优化了退出登录

下一步：完善表，服务端处理创建房间请求





# 第五天



思考：房间列表和信息可以不用数据库表来存储，直接在服务端创建一个结构体，用映射来进行存储即可。由于后面要获取房间列表（根据房间模式进行获取）

roomid->roomInfo

roomid->list< userinfo>

服务端只发送开始结束包

客户端根据身份进行不同操作

房间类中有一个编号到成员窗口的映射，可以根据该映射修改信息（头像）

完成了创建房间的发送、回复处理；房间界面的绘制

下一步：加入房间、退出房间





# 第六天

完成房间列表功能

下一步：点击x退出登录，如果在房间内，先退房间，再退登录；

​				界面内有单独的退出按钮，可以返回上一级；

​				加入房间





# 第七天



加入房间：

1. 客户端发送加入房间请求

​	父类控件所在类维护一个保存子控件链表，在子控件添加进去的时候进行子控件加入房间信号和处理槽的连接；

​	在客户端判断是否加密，密码是否正确；服务端判断等级是否符合房间规定；服务端根据人数和房间状态判断是否观战；

​	密码设定后不可更改，房间内左上角显示房间密码（开放房间；密码：xxx）

2. 服务端处理请求，发送回复

​	服务端发送一个加入房间回复包和一群房间成员列表包，

​	服务端的房间信息中有一个座位号数组（座位号从1开始，到12），每次有新成员加入，遍历该数组，找到一个空座位，赋值给成员（userinfo中加一个座位号，在加入房间的时候，发送给客户端，客户端根据座位号给组件初始化）

​	服务端给刚进入的成员发送原有成员的信息（原有成员的信息：先从房间号->成员列表映射表中获取成员列表，判断该成员是不是新成员本人；根据成员列表的成员id，从数据库中查找该用户的头像等个人信息；再从用户id->用户信息映射表中找到该用户的座位号），给原有成员发送新成员的信息（也要查数据库）。

3. 客户端处理成员列表请求

   通过房间界面类找到成员所在子控件，设置信息

4. 客户端处理加入房间回复

   初始化房间界面信息，生成子控件

   

   

   
